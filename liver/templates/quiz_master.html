<!-- chat/templates/chat/room.html -->
<!DOCTYPE html>
<html>
{% load static %}
<head>
    <!-- Yandex.Metrika counter -->
<script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
 
    ym(52394905, "init", {
         id:52394905,
         clickmap:true,
         trackLinks:true,
         accurateTrackBounce:true
    });
 </script>
 <noscript><div><img src="https://mc.yandex.ru/watch/52394905" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
 <!-- /Yandex.Metrika counter -->
 <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-134643068-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-134643068-1');
</script>
<!-- Facebook Pixel Code -->
<script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '1701043756875290');
        fbq('track', 'PageView');
      </script>
      <noscript><img height="1" width="1" style="display:none"
        src="https://www.facebook.com/tr?id=1701043756875290&ev=PageView&noscript=1"
      /></noscript>
      <!-- End Facebook Pixel Code -->
      <script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://vk.com/js/api/openapi.js?160",t.onload=function(){VK.Retargeting.Init("VK-RTRG-335322-e3qFt"),VK.Retargeting.Hit()},document.head.appendChild(t)}();</script><noscript><img src="https://vk.com/rtrg?p=VK-RTRG-335322-e3qFt" style="position:fixed; left:-999px;" alt=""/></noscript>      
    <link href='{% static "Montserrat.css" %}' rel="stylesheet">
    <meta charset="utf-8"/>
    <title>Game Manager Room</title>
    <link href='{% static "style.css" %}' rel="stylesheet">
</head>
<body class="hands">
    <div class="center">
        <div class="input-holder">
            <input type="text" id="loginInput" placeholder="Логин" style="bottom: -0.5em; width: 70vw;" />
        </div>
        <div class="input-holder">
            <input type="password" id="passwordInput" placeholder="Пароль" />
            <button type="button" id="loginFormButton" onclick="login()"></button>
        </div>
    </div>
</body>
<script>
    var roomName = {{ quiz_url_json }};

    var chatSocket = new WebSocket(
        'wss://' + window.location.host +
        '/ws/quiz/' + roomName + '/');
    let currentTime = {{quiz_object.question_time}};
    let timerInterval = null;

    function timer() {
        document.getElementById("timer").innerHTML = currentTime;
        currentTime -= 1;
    }

    function clear() {
        document.getElementById("timer").innerHTML = "";
        clearInterval(timerInterval);
    }

    function login() {
        let login = document.getElementById("loginInput").value;
        let password = document.getElementById("passwordInput").value;
        //<div class="center"><button class="btn btn3" id="game-start-button">НАЧАТЬ ОПРОС</button>
        chatSocket.onmessage = function processMessage(d) {
            let data = JSON.parse(d.data);
            if (data.message === 'stop_quiz') {
                document.querySelector("#question").disabled = true;
                document.querySelector("#question-results").disabled = true;
            }
        }
        document.body.innerHTML = `<div class="center"><button class="btn btn2" id="question">Следующий вопрос</button>
            <button class="btn btn4" id="question-results">Остановить</button>
            <button class="btn btn2" id="user_score">Показать результаты</button></div><h2 id="timer"></h2>`;
        document.querySelector("#question-results").classList.add("disabled");
        document.querySelector("#user_score").classList.add("disabled");
        document.querySelector("#question-results").disabled = true;
        document.querySelector("#user_score").disabled = false;
        // document.querySelector('#game-start-button').onclick = function(e) {
        //     chatSocket.send(JSON.stringify({
        //         'message': 'start'
        //     }));
            //document.querySelector("#game-start-button").classList.remove("disabled");
            //document.querySelector("#question").classList.remove("disabled");
        document.querySelector('#question').onclick = function(e) {
            chatSocket.send(JSON.stringify({
                'message': 'question'
            }));
            document.querySelector("#question").classList.add("disabled");
            document.querySelector("#question-results").classList.remove("disabled");
            document.querySelector("#question").disabled = true;
            document.querySelector("#question-results").disabled = false;
            currentTime = 15;
            timerInterval = setInterval(timer, 1000);
        };
        document.querySelector('#question-results').onclick = function(e) {
            clear();
            chatSocket.send(JSON.stringify({
                'message': 'question_results'
            }));
            document.querySelector("#question").classList.remove("disabled");
            document.querySelector("#question-results").classList.add("disabled");
            document.querySelector("#question").disabled = false;
            document.querySelector("#question-results").disabled = true;
        };
        document.querySelector('#user_score').onclick = function(e) {
            chatSocket.send(JSON.stringify({
                'message': 'results'
            }));
            //document.querySelector("#game-start-button").classList.add("disabled");
            document.querySelector("#question").classList.add("disabled");
            document.querySelector("#question-results").classList.add("disabled");
            document.querySelector("#user_score").classList.add("disabled");
            document.querySelector("#question").disabled = true;
            document.querySelector("#question-results").disabled = true;
            document.querySelector("#user_score").disabled = true;
        };
     };
    chatSocket.onclose = function(e) {
        console.error('Game socket closed unexpectedly');
    };

    login();
</script>
</html>